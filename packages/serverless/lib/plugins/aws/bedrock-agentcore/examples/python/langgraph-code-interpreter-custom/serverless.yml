# LangGraph Custom Code Interpreter Example
#
# Demonstrates using a custom code interpreter with PUBLIC network mode
# instead of the AWS-managed default (SANDBOX) interpreter.
#
# PUBLIC mode allows code to access external APIs and internet resources.
#
# Deploy: serverless deploy
# Test: python test-invoke.py

service: langgraph-code-interpreter-custom

provider:
  name: aws

ai:
  # Custom code interpreter with PUBLIC network access
  # This creates a AWS::BedrockAgentCore::CodeInterpreterCustom resource
  codeInterpreters:
    publicInterpreter:
      description: Code interpreter with public internet access
      network:
        mode: PUBLIC
      tags:
        Purpose: ExternalAPIAccess

  # Runtime agent that uses the custom code interpreter
  agents:
    codeAgent:
      environment:
        # Pass the custom interpreter ID to the agent
        # Logical ID: getLogicalId('publicInterpreter', 'CodeInterpreter') = 'PublicInterpreterCodeInterpreter'
        CUSTOM_INTERPRETER_ID: !GetAtt PublicInterpreterCodeInterpreter.CodeInterpreterId
      # Grant permission to use the custom code interpreter
      role:
        statements:
          - Effect: Allow
            Action:
              - bedrock-agentcore:InvokeCodeInterpreter
              - bedrock-agentcore:CreateCodeInterpreter
              - bedrock-agentcore:StartCodeInterpreterSession
              - bedrock-agentcore:InvokeCodeInterpreter
              - bedrock-agentcore:StopCodeInterpreterSession
              - bedrock-agentcore:DeleteCodeInterpreter
              - bedrock-agentcore:ListCodeInterpreters
              - bedrock-agentcore:GetCodeInterpreter
              - bedrock-agentcore:GetCodeInterpreterSession
              - bedrock-agentcore:ListCodeInterpreterSessions
            Resource: !GetAtt PublicInterpreterCodeInterpreter.CodeInterpreterArn
