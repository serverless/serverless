# Example: Simplified Tools Configuration for Bedrock AgentCore
#
# This example demonstrates the new tools-based syntax where:
# - Gateway is auto-created when tools exist (no explicit type: gateway needed)
# - Tools can be defined at shared level (agents.tools) or agent level (agents.<agent>.tools)
# - Agent-level tools can reference shared tools by name (string reference)
#
# Supported tool types:
# - function: Lambda function tool (requires toolSchema)
# - openapi: OpenAPI specification (file path or inline)
# - smithy: Smithy model (file path or inline)
# - mcp: MCP server endpoint (https:// URL)

service: my-agent-service

provider:
  name: aws
  runtime: python3.12
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}

  # Optional: Configure the auto-created gateway
  agents:
    gateway:
      authorizerType: AWS_IAM  # NONE | AWS_IAM | CUSTOM_JWT
      # description: My service gateway
      # kmsKeyArn: arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012

# Lambda functions that can be used as tools
functions:
  orderApi:
    handler: handlers/orders.handler
    description: Order management API

  userApi:
    handler: handlers/users.handler
    description: User management API

agents:
  # Shared tools (available to reference from any agent)
  tools:
    # Lambda function tool
    order-tool:
      function: orderApi  # Reference to functions.orderApi
      toolSchema:  # Required for Lambda tools
        - name: getOrder
          description: Retrieves order details by ID
          inputSchema:
            type: object
            properties:
              orderId:
                type: string
                description: The order ID
            required:
              - orderId

    # OpenAPI tool - file path (auto-detected)
    rest-api:
      openapi: specs/openapi.yml

    # MCP server tool
    linear-mcp:
      mcp: https://mcp.linear.app/mcp

    # MCP server with OAuth credentials
    external-api:
      mcp: https://external-api.example.com/mcp
      credentials:
        type: OAUTH
        providerArn: arn:aws:secretsmanager:us-east-1:123456789012:secret:my-oauth-creds
        scopes:
          - read
          - write

    # MCP server with API key
    api-key-service:
      mcp: https://api.service.com/mcp
      credentials:
        type: API_KEY
        providerArn: arn:aws:secretsmanager:us-east-1:123456789012:secret:api-key

    # Smithy model tool
    smithy-service:
      smithy: models/service.smithy

  # Runtime agent with tools
  # BEDROCK_AGENTCORE_GATEWAY_URL is automatically injected when tools are configured
  assistantAgent:
    type: runtime
    artifact:
      containerImage: 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-agent:latest

    # Agent-level tools: can be inline or reference shared tools
    tools:
      # Reference shared tool by name (string)
      orders: order-tool
      linear: linear-mcp

      # Inline Lambda function tool
      users:
        function:
          arn: arn:aws:lambda:us-east-1:123456789012:function:external-user-api
        toolSchema:
          - name: getUser
            description: Gets user by ID
            inputSchema:
              type: object
              properties:
                userId:
                  type: string

      # Inline OpenAPI tool
      weather-api:
        openapi: |
          openapi: 3.0.0
          info:
            title: Weather API
            version: 1.0.0
          paths:
            /weather:
              get:
                summary: Get weather
                parameters:
                  - name: location
                    in: query
                    required: true
                    schema:
                      type: string

  # Another runtime agent with different tools
  researchAgent:
    type: runtime
    artifact:
      containerImage: 123456789012.dkr.ecr.us-east-1.amazonaws.com/research-agent:latest
    tools:
      # Reference shared tools
      api: rest-api
      external: external-api
      smithy: smithy-service
