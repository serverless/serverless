# Runtime with S3 Code Deployment Example
# Deploy Python agents without Docker using S3 code artifacts

service: s3-code-agent

provider:
  name: aws
  region: ${opt:region, 'us-east-1'}
  stage: ${opt:stage, 'dev'}

custom:
  agentCore:
    defaultTags:
      Project: S3CodeAgent

agents:
  # Runtime using S3-based code deployment (no Docker required)
  # Requires Python code to be uploaded to S3 as a zip file
  pythonAgent:
    type: runtime
    description: Python agent deployed from S3 code artifact
    artifact:
      s3:
        bucket: my-agent-artifacts-bucket
        key: agents/my-agent.zip
        # Optional: specific version
        # versionId: abc123
      # Python runtime version
      runtime: PYTHON_3_12 # PYTHON_3_10, PYTHON_3_11, PYTHON_3_12, PYTHON_3_13
      # Entry point: [module, function]
      entryPoint:
        - main
        - handler
    protocol: HTTP
    network:
      networkMode: PUBLIC

  # Runtime with lifecycle configuration
  managedAgent:
    type: runtime
    description: Agent with lifecycle management
    artifact:
      s3:
        bucket: my-agent-artifacts-bucket
        key: agents/managed-agent.zip
      runtime: PYTHON_3_12
      entryPoint:
        - agent
        - run
    protocol: HTTP
    network:
      networkMode: PUBLIC
    # Configure session timeouts
    lifecycle:
      # Idle session timeout (60-28800 seconds)
      idleRuntimeSessionTimeout: 300 # 5 minutes
      # Maximum session lifetime (60-28800 seconds)
      maxLifetime: 7200 # 2 hours

  # Runtime with environment variables
  configuredAgent:
    type: runtime
    description: Agent with environment configuration
    artifact:
      s3:
        bucket: my-agent-artifacts-bucket
        key: agents/configured-agent.zip
      runtime: PYTHON_3_12
      entryPoint:
        - main
        - handler
    protocol: HTTP
    network:
      networkMode: PUBLIC
    environment:
      LOG_LEVEL: DEBUG
      MODEL_ID: us.anthropic.claude-3-7-sonnet-20250219-v1:0
      MAX_TOKENS: '4096'
